<script>
	import { gsap } from 'gsap'
	import { onMount } from 'svelte'

	export let animationDuration = 3 // animation duration in seconds
	export let isAnimating = false // animation trigger from parent

	let pathRefs = []
	let svgRef
	let animations = []

	// Define path data for animation from Nft.svelte to NftEnd.svelte
	const pathData = [
		{
			from: 'M69.0343 41.9316L70.0894 122.673L74.2573 120.406L73.2022 39.6651L69.0343 41.9316Z',
			to: 'M75.3536 51.5505L55.207 148.24L60.7847 146.638L80.9312 49.9492L75.3536 51.5505Z'
		},
		{
			from: 'M69.0786 41.9292L70.1336 122.67L17.4207 92.7562L16.3755 12.0598L69.0786 41.9292Z',
			to: 'M75.408 51.5605L55.2614 148.25L0.25 98.5552L20.3966 1.92188L75.408 51.5605Z'
		},
		{
			from: 'M16.378 12.0652L69.081 41.9345L73.201 39.6631L20.4285 9.76243L16.378 12.0652Z',
			to: 'M20.3984 1.92572L75.4098 51.5644L80.9315 49.9445L25.8455 0.25L20.3984 1.92572Z'
		},
		{
			from: 'M20.2348 90.7769L19.2795 17.7323L65.9539 43.9505L66.9009 117.028L20.2348 90.7769Z',
			to: 'M4.13281 96.9376L22.358 9.46484L71.1389 53.1454L52.895 140.655L4.13281 96.9376Z'
		},
		{
			from: 'M21.0439 90.4101L20.103 18.2044L19.2795 17.7323L20.2348 90.7769L66.9009 117.028L66.8898 116.204L21.0439 90.4101Z',
			to: 'M5.1961 96.7141L23.2161 10.2468L22.358 9.46484L4.13281 96.9376L52.895 140.655L53.1002 139.669L5.1961 96.7141Z'
		},
		{
			from: 'M39.5034 42.886L39.5465 45.5428L42.6121 47.3883L42.569 44.7314L45.365 46.4184L45.4082 49.0752L48.4738 50.9206L48.4306 48.2638L51.3689 50.0283L51.412 52.6852L54.1535 54.3375C54.4958 54.5422 54.2275 55.1631 54.2257 55.3662C54.21 56.7731 54.2075 58.2394 54.4217 59.7667L57.3599 61.5313L57.4235 66.0392L60.3618 67.8037L60.8338 103.984L57.8956 102.22L57.9387 104.876L55.0004 103.112L55.0436 105.769L43.3021 98.6925L43.3701 103.995L40.5013 102.261L40.3063 101.946L40.2116 94.0614L37.4156 92.3745L37.3872 89.8547L34.449 88.0901L34.4058 85.4333C34.2438 85.4069 34.0124 85.0684 33.9396 85.0222L31.471 83.5432L31.6468 96.9299L28.5813 95.0845L28.2885 72.0248L29.2244 72.5811L29.2005 70.9959L27.3255 69.8685L27.3493 71.594L26.4977 71.0658L26.3027 70.7505L26.188 63.1977L26.3965 63.011L28.1773 64.0658L27.973 48.2997L30.9113 50.0642L30.8478 45.5563L33.9133 47.4018L33.8453 42.0996L36.6413 43.7866L36.6113 41.3295L36.8132 41.2535L39.5547 42.9058L39.5034 42.886ZM39.6634 55.2159L33.9985 51.7957L33.7966 51.8717L33.8266 54.3288L31.0851 52.6765L30.8833 52.7525L30.9814 60.5117L57.5118 76.4982L57.4137 68.739L57.2187 68.4236L54.4772 66.7713L54.4472 64.3143L54.2522 63.9989L48.5873 60.5788L48.6304 63.2356L45.7616 61.5025L45.5598 61.5785L45.5864 64.161L42.7903 62.4741L42.7637 59.8915L42.5687 59.5762L39.6999 57.843L39.6568 55.1861L39.6634 55.2159ZM42.7626 70.3703L34.09 65.1543L34.12 67.6114L33.9182 67.6874L28.2533 64.2672L28.3215 69.429L31.1175 71.116L31.1442 73.6985L31.3392 74.0139L34.0807 75.6662L34.1107 78.1232L34.3057 78.4386L37.0472 80.0909L37.0903 82.7477L54.7629 93.3878L54.9647 93.3118L54.9347 90.8547L57.7308 92.5417L57.5515 79.2805L48.7516 73.9836L48.7947 76.6405L42.9876 73.1427L42.7926 72.8274L42.7626 70.3703Z',
			to: 'M39.8339 44.8618L39.181 48.0456L42.3522 51.0619L43.0051 47.8781L45.8965 50.6337L45.2436 53.8176L48.4149 56.8339L49.0678 53.65L52.1084 56.536L51.4555 59.7198L54.291 62.4196C54.6454 62.7548 54.1604 63.425 54.1044 63.6671C53.7127 65.3428 53.3209 67.093 53.1717 68.9735L56.2123 71.8595L55.0931 77.2591L58.1337 80.145L49.1051 123.472L46.0644 120.586L45.4115 123.77L42.3709 120.884L41.718 124.068L29.5741 112.505L28.2496 118.854L25.2836 116.024L25.1344 115.596L27.1117 106.156L24.2203 103.4L24.8545 100.384L21.8139 97.4981L22.4668 94.3142C22.2803 94.2397 22.0937 93.7742 22.0191 93.6998L19.4635 91.2793L16.1243 107.31L12.9531 104.294L18.7173 76.6819L19.6873 77.5942L20.079 75.6951L18.139 73.8518L17.71 75.9185L16.8332 75.062L16.684 74.6338L18.5494 65.5849L18.8479 65.4173L20.6946 67.1489L24.6307 48.2691L27.6713 51.155L28.7906 45.7555L31.9618 48.7718L33.2863 42.4226L36.1777 45.1783L36.7933 42.2365L37.0544 42.1992L39.8899 44.899L39.8339 44.8618ZM36.756 59.6267L30.8985 54.041L30.6374 54.0782L30.0218 57.0201L27.1863 54.3203L26.9252 54.3575L24.9851 63.6485L52.4255 89.7711L54.3656 80.4802L54.2163 80.0519L51.3809 77.3522L51.9965 74.4103L51.8472 73.9821L45.9898 68.3964L45.3369 71.5802L42.3709 68.7501L42.1097 68.7874L41.4568 71.8781L38.5654 69.1225L39.2183 66.0317L39.0691 65.6035L36.1031 62.7734L36.756 59.5895L36.756 59.6267ZM36.4388 78.5438L27.4661 70.0162L26.8505 72.958L26.5894 72.9953L20.732 67.4095L19.4448 73.5911L22.3362 76.3467L21.6833 79.4375L21.8326 79.8657L24.668 82.5655L24.0524 85.5073L24.2016 85.9356L27.0371 88.6354L26.3842 91.8192L44.6654 109.21L44.9265 109.172L45.5421 106.23L48.4335 108.986L51.7353 93.104L42.632 84.446L41.9791 87.6299L35.9725 81.9139L35.8232 81.4856L36.4388 78.5438Z'
		},
		{
			from: 'M49.9664 85.1102L49.9931 87.6928L49.8061 87.7655L46.9373 86.0323L46.8976 83.2499L49.9664 85.1102Z',
			to: 'M41.1349 98.0584L40.482 101.149L40.2395 101.186L37.2734 98.3563L37.9636 95.0234L41.1349 98.0584Z'
		},
		{
			from: 'M53.6069 79.5279L53.6114 80.3221L52.6755 79.7659L52.6915 80.6823L53.758 81.3343L53.7386 80.5434L54.5472 81.0187L54.5711 82.6039L51.7601 80.9203L51.7318 78.4005L53.6069 79.5279Z',
			to: 'M46.9571 92.3589L46.7519 93.3085L45.7819 92.3962L45.558 93.4947L46.6586 94.556L46.8452 93.6064L47.6846 94.3884L47.2929 96.2876L44.3828 93.5319L45.0171 90.5156L46.9571 92.3589Z'
		},
		{
			from: 'M38.9318 70.6952L38.9512 71.4862L37.8731 70.8523L37.8924 71.7836L38.9556 72.4208L38.9511 71.6265L39.887 72.1828L39.8993 73.7862L37.1 72.0844L37.0716 69.5645L38.9318 70.6952Z',
			to: 'M31.7744 77.9175L31.5878 78.8671L30.4686 77.8244L30.2447 78.9416L31.3453 79.9842L31.5505 79.0347L32.5206 79.947L32.1102 81.8648L29.2188 79.0905L29.853 76.0742L31.7744 77.9175Z'
		}
	]

	// Define position animation data
	const positionData = {
		from: { x: 125, y: 51 },
		to: { x: 187, y: 36 }
	}

	function startAnimations() {
		// Clear existing animations
		animations.forEach((anim) => anim.kill())
		animations = []

		// Animate paths to final state (no yoyo, no repeat)
		pathRefs.forEach((path, index) => {
			if (path && pathData[index]) {
				const anim = gsap.to(path, {
					duration: animationDuration,
					ease: 'power2.inOut',
					attr: { d: pathData[index].to }
				})
				animations.push(anim)
			}
		})

		// Animate SVG position
		if (svgRef) {
			const anim = gsap.to(svgRef, {
				duration: animationDuration,
				ease: 'power2.inOut',
				attr: {
					x: positionData.to.x,
					y: positionData.to.y
				}
			})
			animations.push(anim)
		}
	}

	function stopAnimations() {
		// Stop all animations and animate back to initial state
		animations.forEach((anim) => anim.kill())
		animations = []

		// Animate paths back to initial state
		pathRefs.forEach((path, index) => {
			if (path && pathData[index]) {
				const anim = gsap.to(path, {
					duration: animationDuration,
					ease: 'power2.inOut',
					attr: { d: pathData[index].from }
				})
				animations.push(anim)
			}
		})

		// Animate SVG position back
		if (svgRef) {
			const anim = gsap.to(svgRef, {
				duration: animationDuration,
				ease: 'power2.inOut',
				attr: {
					x: positionData.from.x,
					y: positionData.from.y
				}
			})
			animations.push(anim)
		}
	}

	// Watch for animation state changes
	$: if (isAnimating) {
		startAnimations()
	} else {
		stopAnimations()
	}

	onMount(() => {
		// Set initial path data
		pathRefs.forEach((path, index) => {
			if (path && pathData[index]) {
				path.setAttribute('d', pathData[index].from)
			}
		})

		// Set initial SVG position
		if (svgRef) {
			gsap.set(svgRef, {
				attr: {
					x: positionData.from.x,
					y: positionData.from.y
				}
			})
		}
	})
</script>

<svg
	width="82"
	height="149"
	viewBox="0 0 82 149"
	fill="none"
	xmlns="http://www.w3.org/2000/svg"
	bind:this={svgRef}
>
	<path
		bind:this={pathRefs[0]}
		d="M69.0343 41.9316L70.0894 122.673L74.2573 120.406L73.2022 39.6651L69.0343 41.9316Z"
		fill="#202221"
		stroke="#202221"
		stroke-width="0.5"
		stroke-linejoin="round"
	/>
	<path
		bind:this={pathRefs[1]}
		d="M69.0786 41.9292L70.1336 122.67L17.4207 92.7562L16.3755 12.0598L69.0786 41.9292Z"
		fill="#D9D9D9"
		stroke="#202221"
		stroke-width="0.5"
		stroke-linejoin="round"
	/>
	<path
		bind:this={pathRefs[2]}
		d="M16.378 12.0652L69.081 41.9345L73.201 39.6631L20.4285 9.76243L16.378 12.0652Z"
		fill="#202221"
		stroke="#202221"
		stroke-width="0.5"
		stroke-linejoin="round"
	/>
	<path
		bind:this={pathRefs[3]}
		d="M20.2348 90.7769L19.2795 17.7323L65.9539 43.9505L66.9009 117.028L20.2348 90.7769Z"
		fill="#D9D9D9"
		stroke="#202221"
		stroke-width="0.5"
		stroke-linejoin="round"
	/>
	<path
		bind:this={pathRefs[4]}
		d="M21.0439 90.4101L20.103 18.2044L19.2795 17.7323L20.2348 90.7769L66.9009 117.028L66.8898 116.204L21.0439 90.4101Z"
		fill="#D9D9D9"
		stroke="#202221"
		stroke-width="0.5"
		stroke-linejoin="round"
	/>
	<path
		bind:this={pathRefs[5]}
		d="M39.5034 42.886L39.5465 45.5428L42.6121 47.3883L42.569 44.7314L45.365 46.4184L45.4082 49.0752L48.4738 50.9206L48.4306 48.2638L51.3689 50.0283L51.412 52.6852L54.1535 54.3375C54.4958 54.5422 54.2275 55.1631 54.2257 55.3662C54.21 56.7731 54.2075 58.2394 54.4217 59.7667L57.3599 61.5313L57.4235 66.0392L60.3618 67.8037L60.8338 103.984L57.8956 102.22L57.9387 104.876L55.0004 103.112L55.0436 105.769L43.3021 98.6925L43.3701 103.995L40.5013 102.261L40.3063 101.946L40.2116 94.0614L37.4156 92.3745L37.3872 89.8547L34.449 88.0901L34.4058 85.4333C34.2438 85.4069 34.0124 85.0684 33.9396 85.0222L31.471 83.5432L31.6468 96.9299L28.5813 95.0845L28.2885 72.0248L29.2244 72.5811L29.2005 70.9959L27.3255 69.8685L27.3493 71.594L26.4977 71.0658L26.3027 70.7505L26.188 63.1977L26.3965 63.011L28.1773 64.0658L27.973 48.2997L30.9113 50.0642L30.8478 45.5563L33.9133 47.4018L33.8453 42.0996L36.6413 43.7866L36.6113 41.3295L36.8132 41.2535L39.5547 42.9058L39.5034 42.886ZM39.6634 55.2159L33.9985 51.7957L33.7966 51.8717L33.8266 54.3288L31.0851 52.6765L30.8833 52.7525L30.9814 60.5117L57.5118 76.4982L57.4137 68.739L57.2187 68.4236L54.4772 66.7713L54.4472 64.3143L54.2522 63.9989L48.5873 60.5788L48.6304 63.2356L45.7616 61.5025L45.5598 61.5785L45.5864 64.161L42.7903 62.4741L42.7637 59.8915L42.5687 59.5762L39.6999 57.843L39.6568 55.1861L39.6634 55.2159ZM42.7626 70.3703L34.09 65.1543L34.12 67.6114L33.9182 67.6874L28.2533 64.2672L28.3215 69.429L31.1175 71.116L31.1442 73.6985L31.3392 74.0139L34.0807 75.6662L34.1107 78.1232L34.3057 78.4386L37.0472 80.0909L37.0903 82.7477L54.7629 93.3878L54.9647 93.3118L54.9347 90.8547L57.7308 92.5417L57.5515 79.2805L48.7516 73.9836L48.7947 76.6405L42.9876 73.1427L42.7926 72.8274L42.7626 70.3703Z"
		fill="#202221"
	/>
	<path
		bind:this={pathRefs[6]}
		d="M49.9664 85.1102L49.9931 87.6928L49.8061 87.7655L46.9373 86.0323L46.8976 83.2499L49.9664 85.1102Z"
		fill="#202221"
	/>
	<path
		bind:this={pathRefs[7]}
		d="M53.6069 79.5279L53.6114 80.3221L52.6755 79.7659L52.6915 80.6823L53.758 81.3343L53.7386 80.5434L54.5472 81.0187L54.5711 82.6039L51.7601 80.9203L51.7318 78.4005L53.6069 79.5279Z"
		fill="#202221"
	/>
	<path
		bind:this={pathRefs[8]}
		d="M38.9318 70.6952L38.9512 71.4862L37.8731 70.8523L37.8924 71.7836L38.9556 72.4208L38.9511 71.6265L39.887 72.1828L39.8993 73.7862L37.1 72.0844L37.0716 69.5645L38.9318 70.6952Z"
		fill="#202221"
	/>
</svg>
